function toArray(e){return e=e||{},[].slice.call(e)}function getSheetRules(e){var t=e.media&&e.media.mediaText;return e.disabled?[]:t&&t.length&&!window.matchMedia(t).matches?[]:toArray(e.cssRules)}function _find(e,t){e.match(t);return t?t.length:0}function calculateScore(e){for(var t,n,i=[0,0,0],c=e.split(" ");t=c.shift(),"string"==typeof t;)n=_find(t,PSEUDO_ELEMENTS_RE),i[2]=n,n&&(t=t.replace(PSEUDO_ELEMENTS_RE,"")),n=_find(t,PSEUDO_CLASSES_RE),i[1]=n,n&&(t=t.replace(PSEUDO_CLASSES_RE,"")),n=_find(t,ATTR_RE),i[1]+=n,n&&(t=t.replace(ATTR_RE,"")),n=_find(t,ID_RE),i[0]=n,n&&(t=t.replace(ID_RE,"")),n=_find(t,CLASS_RE),i[1]+=n,n&&(t=t.replace(CLASS_RE,"")),i[2]+=_find(t,ELEMENT_RE);return parseInt(i.join(""),10)}function getSpecificityScore(e,t){for(var n,i,c=t.split(","),r=0;n=c.shift();)e.matches=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector,e.matches(n)&&(i=calculateScore(n),r=i>r?i:r);return r}function sortBySpecificity(e,t){function n(t,n){return getSpecificityScore(e,n.selectorText)-getSpecificityScore(e,t.selectorText)}return t.sort(n)}function getNodeCSSRules(e){var t,n,i,c,r=[];for(t=toArray(window.document.styleSheets);n=t.shift();)for(i=getSheetRules(n);c=i.shift();)c.styleSheet?i=getSheetRules(c.styleSheet).concat(i):c.media?i=getSheetRules(c).concat(i):e.matches(c.selectorText)&&r.push(c);return sortBySpecificity(e,r)}function explainWarning(){window.explained||(console.log("%cWhen 'getMatchedCSSRules()' is removed, Critical Snapshot will fallback to a polyfill. Untill then, we will use the native version for better performance.","color: aqua;"),window.explained=!0)}function selectText(e){var t=document.getElementById(e),n=document.createRange();n.selectNodeContents(t);var i=window.getSelection();i.removeAllRanges(),i.addRange(n)}function removeDocumentStyles(){var e=[].slice.call(document.querySelectorAll('[type="text/css"]'));e.forEach(function(e){e.remove()});var t=[].slice.call(document.getElementsByTagName("style"));t.forEach(function(e){e.remove()})}function generatePopup(){var e=function(e){e.preventDefault(),e.stopPropagation(),selectText("CriticalSnap__output-css"),document.execCommand("copy"),u.style.backgroundColor="#34A853",u.style.color="#fff",u.innerHTML="Copied <span>üëç</span>"},t=function(e){e.preventDefault(),e.stopPropagation(),removeDocumentStyles();var n=document.createElement("style");n.innerHTML=l,document.getElementsByTagName("head")[0].appendChild(n),d.removeEventListener("click",t),d.remove(),r()},n=function(e){e.preventDefault(),e.stopPropagation(),selectText("CriticalSnap__output-css")},i=function(e){e&&e.preventDefault(),o()},c=function(e){var t=document.createElement("div");t.id="CriticalSnap";var n="";return n+="<div><h1>Critical Snapshot</h1>",n+='<p id="CriticalSnap__output-css">',n+=e,n+="</p>",n+='<div id="CriticalSnap__buttons">',n+='<button type="button" class="CriticalSnap__button" id="CriticalSnap__copy">Copy</button>',n+='<button type="button" class="CriticalSnap__button" id="CriticalSnap__preview">Preview</button>',n+='<button type="button" class="CriticalSnap__button" id="CriticalSnap__close">Close</button>',n+="</div>",n+="</div>",t.innerHTML=n,t},r=function(){s.className="CriticalSnap__minified"},o=function(){u.removeEventListener("click",e),d.removeEventListener("click",t),p.removeEventListener("click",n),S.removeEventListener("click",i),s.remove()};document.body.scrollTop=0;var a=new CriticalSnapshot(window,document),l=a.generate(),s=c(l);document.body.appendChild(s);var u=document.getElementById("CriticalSnap__copy"),d=document.getElementById("CriticalSnap__preview"),p=document.getElementById("CriticalSnap__output-css"),S=document.getElementById("CriticalSnap");u.addEventListener("click",e),d.addEventListener("click",t),p.addEventListener("click",n),S.addEventListener("click",i)}var ELEMENT_RE=/[\w-]+/g,ID_RE=/#[\w-]+/g,CLASS_RE=/\.[\w-]+/g,ATTR_RE=/\[[^\]]+\]/g,PSEUDO_CLASSES_RE=/\:(?!not)[\w-]+(\(.*\))?/g,PSEUDO_ELEMENTS_RE=/\:\:?(after|before|first-letter|first-line|selection)/g,CriticalSnapshot=function(e,t,n){var n=n||{},i={},c=function(e){!!i[e.selectorText]==!1&&(i[e.selectorText]={});var t=e.style.cssText.split(/;(?![A-Za-z0-9])/);t.forEach(function(t){if(!!t!=!1){var n=t.split(": ");n[0]=n[0].trim(),n[1]=n[1].trim(),i[e.selectorText][n[0]]=n[1]}})},r=function(){for(var i=e.innerHeight,r=t.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,function(e){return NodeFilter.FILTER_ACCEPT},!0);r.nextNode();){var o=r.currentNode,a=o.getBoundingClientRect();if(a.top<i||n.scanFullPage){var l;if("function"!=typeof e.getMatchedCSSRules?l=getNodeCSSRules(o):(l=e.getMatchedCSSRules(o),explainWarning()),l||(l=getNodeCSSRules(o)),l)for(var s=0;s<l.length;s++)c(l[s])}}};this.generate=function(){var e="";for(var t in i){e+=t+"{";for(var n in i[t])e+=n+":"+i[t][n]+";";e+="}"}return e},r()};generatePopup();
